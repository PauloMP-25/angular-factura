<div class="modal-overlay" *ngIf="isModalVisible" (click)="cerrar()">
    <div class="modal-content" (click)="$event.stopPropagation()">

        <div *ngIf="loading()">
            <p>Cargando detalles de boleta...</p>
        </div>
        <div *ngIf="error()">
            <p class="message-error">{{ error() }}</p>
            <button class="btn btn-danger" (click)="cerrar()">Cerrar</button>
        </div>

        <div class="container invoice-box" *ngIf="boleta()">

            <button class="close-button" (click)="cerrar()">×</button>

            <div class="row mb-3">
                <div class="col-6 d-flex align-items-center">
                    <img src="https://i.ibb.co/L8B8Y2M/ikaza-logo.png" alt="Logo" class="logo-empresa">
                    <span class="logo-text">MiFactura</span>
                </div>
                <div class="col-6 text-end header-box">
                    <h5 class="mb-1">RUC 10715528407</h5>
                    <h6 class="mb-0">Boleta de Venta</h6>
                    <h5 class="fw-bold text-success">BOLETA #{{ boleta()!.idBoleta }}</h5>
                </div>
            </div>

            <div class="row mb-3 info-clientes">
                <div class="col-6">
                    <p class="mb-1"><strong>Cliente: </strong> <span>{{ boleta()!.nombreCliente }}</span></p>
                    <p class="mb-1"><strong>Documento: </strong> <span>{{ boleta()!.documentoCliente
                            }}</span></p>
                    <p class="mb-1"><strong>Email: </strong> <span>{{ boleta()!.emailCliente }}</span></p>
                    <p class="mb-1"><strong>Estado: </strong> <span class="text-success fw-bold">PAGADO</span></p>
                </div>
                <div class="col-6 text-end">
                    <p class="mb-1"><strong>Fecha de emisión:</strong>
                        <span>{{ boletaService.formatearFecha(boleta()!.fecha_creacion) }}</span>
                    </p>
                    <p class="mt-2 mb-1">
                        <strong>Vendedor:</strong>
                        <span *ngIf="boleta()!.usuarioVendedor as vendedor">
                            {{ vendedor.nombres }} {{ vendedor.apellidos }}
                            <br>
                            <small class="text-muted">DNI/RUC: {{ vendedor.numero_documento }}</small>
                            <br>
                            <!--<small class="text-muted">Email: {{ vendedor.email }}</small>-->
                        </span>
                        <span *ngIf="!boleta()!.usuarioVendedor">
                            Usuario ID {{ boleta()!.idUsuario }} (Datos no disponibles)
                        </span>
                    </p>
                </div>
            </div>

            <div class="row mb-2">
                <div class="col-12">
                    <table class="table table-sm">
                        <thead>
                            <tr class="bg-success text-white">
                                <th>Cant.</th>
                                <th>Descripción</th>
                                <th>P.Unit</th>
                                <th class="text-end">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of detalles()">
                                <td>{{ item.cantidad }}</td>
                                <td>{{ item.producto }}</td>
                                <td>{{ boletaService.formatearPrecio(item.precio_unitario) }}</td>
                                <td class="text-end">{{ boletaService.formatearPrecio(item.subtotal || (item.cantidad *
                                    item.precio_unitario)) }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="row info-totales">
                <div class="col-6">
                    <h6 class="fw-bold">Totales:</h6>
                    <p class="mb-1">El monto total incluye impuestos (IGV 18%)</p>
                </div>
                <div class="col-6 text-end">
                    <table class="table table-sm total-table">
                        <tbody>
                            <tr>
                                <td class="text-end border-0 fw-bold">Total Pagado: S/</td>
                                <td class="text-end border-0 fw-bold text-success fs-5">{{
                                    boletaService.formatearPrecio(boleta()!.total) }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>

    </div>
</div>